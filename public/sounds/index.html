<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .sound-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 300px;
        }
        .sound-card h3 {
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }
        .btn-group {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button.play {
            background-color: #2196F3;
        }
        button.play:hover {
            background-color: #0b7dda;
        }
        button.download {
            background-color: #ff9800;
        }
        button.download:hover {
            background-color: #e68a00;
        }
        .description {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>Notification Sound Generator</h1>
    
    <div class="container">
        <div class="sound-card">
            <h3>Message Sound</h3>
            <div class="description">A short high-pitched beep sound for new messages.</div>
            <div class="btn-group">
                <button class="play" onclick="playMessageSound()">Play</button>
                <button class="download" onclick="downloadMessageSound()">Download</button>
            </div>
        </div>
        
        <div class="sound-card">
            <h3>New Session Sound</h3>
            <div class="description">A two-note alert sound for new chat sessions.</div>
            <div class="btn-group">
                <button class="play" onclick="playNewSessionSound()">Play</button>
                <button class="download" onclick="downloadNewSessionSound()">Download</button>
            </div>
        </div>
        
        <div class="sound-card">
            <h3>Notification Sound</h3>
            <div class="description">A general notification sound with rising pitch.</div>
            <div class="btn-group">
                <button class="play" onclick="playNotificationSound()">Play</button>
                <button class="download" onclick="downloadNotificationSound()">Download</button>
            </div>
        </div>
        
        <div class="sound-card">
            <h3>Test Sound</h3>
            <div class="description">A three-note sequence for testing audio playback.</div>
            <div class="btn-group">
                <button class="play" onclick="playTestSound()">Play</button>
                <button class="download" onclick="downloadTestSound()">Download</button>
            </div>
        </div>
    </div>
    
    <script>
        // Hàm chuyển đổi AudioBuffer thành WAV
        function bufferToWave(abuffer, len) {
            const numOfChan = abuffer.numberOfChannels;
            const length = len * numOfChan * 2 + 44;
            const buffer = new ArrayBuffer(length);
            const view = new DataView(buffer);
            const channels = [];
            let i;
            let sample;
            let offset = 0;
            let pos = 0;
            
            // Viết WAVE header
            setUint32(0x46464952);                         // "RIFF"
            setUint32(length - 8);                         // file length - 8
            setUint32(0x45564157);                         // "WAVE"
            
            setUint32(0x20746d66);                         // "fmt " chunk
            setUint32(16);                                 // length = 16
            setUint16(1);                                  // PCM (uncompressed)
            setUint16(numOfChan);
            setUint32(abuffer.sampleRate);
            setUint32(abuffer.sampleRate * 2 * numOfChan); // avg. bytes/sec
            setUint16(numOfChan * 2);                      // block-align
            setUint16(16);                                 // 16-bit
            
            setUint32(0x61746164);                         // "data" - chunk
            setUint32(length - pos - 4);                   // chunk length
            
            // Lưu trữ giá trị mẫu
            for (i = 0; i < abuffer.numberOfChannels; i++) {
                channels.push(abuffer.getChannelData(i));
            }
            
            while (pos < length) {
                for (i = 0; i < numOfChan; i++) {
                    // Interleave channels
                    sample = Math.max(-1, Math.min(1, channels[i][offset])); // Clamp
                    sample = (0.5 + sample < 0 ? sample * 32768 : sample * 32767) | 0; // Scale to 16-bit signed int
                    view.setInt16(pos, sample, true);  // Write 16-bit sample
                    pos += 2;
                }
                offset++; // Next source sample
            }
            
            return new Blob([buffer], { type: 'audio/wav' });
            
            function setUint16(data) {
                view.setUint16(pos, data, true);
                pos += 2;
            }
            
            function setUint32(data) {
                view.setUint32(pos, data, true);
                pos += 4;
            }
        }

        // Hàm tạo âm thanh tin nhắn
        function createMessageSound(play = false, download = false) {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioCtx = new AudioContext();
                
                // Tạo oscillator
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); // A5
                
                // Tạo gain node để điều chỉnh âm lượng
                const gainNode = audioCtx.createGain();
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                
                // Kết nối và bắt đầu
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                if (play) {
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    return;
                }
                
                // Xuất ra file audio khi download
                if (download) {
                    const length = 0.3;
                    const offlineCtx = new OfflineAudioContext(1, length * audioCtx.sampleRate, audioCtx.sampleRate);
                    
                    const offlineOscillator = offlineCtx.createOscillator();
                    offlineOscillator.type = 'sine';
                    offlineOscillator.frequency.setValueAtTime(880, offlineCtx.currentTime);
                    
                    const offlineGain = offlineCtx.createGain();
                    offlineGain.gain.setValueAtTime(0, offlineCtx.currentTime);
                    offlineGain.gain.linearRampToValueAtTime(0.3, offlineCtx.currentTime + 0.01);
                    offlineGain.gain.linearRampToValueAtTime(0, offlineCtx.currentTime + 0.3);
                    
                    offlineOscillator.connect(offlineGain);
                    offlineGain.connect(offlineCtx.destination);
                    
                    offlineOscillator.start();
                    offlineOscillator.stop(offlineCtx.currentTime + 0.3);
                    
                    offlineCtx.startRendering().then(buffer => {
                        const blob = bufferToWave(buffer, length * audioCtx.sampleRate);
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = 'message.mp3';
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                        }, 100);
                    });
                }
                
            } catch (error) {
                console.error('Audio Context not supported or error generating sound', error);
            }
        }

        // Hàm tạo âm thanh phiên mới
        function createNewSessionSound(play = false, download = false) {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioCtx = new AudioContext();
                
                // Tạo oscillator
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sine';
                
                // Tạo gain node để điều chỉnh âm lượng
                const gainNode = audioCtx.createGain();
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                
                // Kết nối và bắt đầu
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                // Tạo âm thanh 2 nốt
                oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                
                if (play) {
                    oscillator.start();
                    oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.25); // G5
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    return;
                }
                
                // Xuất ra file audio khi download
                if (download) {
                    const length = 0.5;
                    const offlineCtx = new OfflineAudioContext(1, length * audioCtx.sampleRate, audioCtx.sampleRate);
                    
                    const offlineOscillator = offlineCtx.createOscillator();
                    offlineOscillator.type = 'sine';
                    
                    const offlineGain = offlineCtx.createGain();
                    offlineGain.gain.setValueAtTime(0, offlineCtx.currentTime);
                    offlineGain.gain.linearRampToValueAtTime(0.3, offlineCtx.currentTime + 0.01);
                    offlineGain.gain.linearRampToValueAtTime(0, offlineCtx.currentTime + 0.5);
                    
                    offlineOscillator.connect(offlineGain);
                    offlineGain.connect(offlineCtx.destination);
                    
                    offlineOscillator.frequency.setValueAtTime(523.25, offlineCtx.currentTime); // C5
                    offlineOscillator.start();
                    offlineOscillator.frequency.setValueAtTime(783.99, offlineCtx.currentTime + 0.25); // G5
                    offlineOscillator.stop(offlineCtx.currentTime + 0.5);
                    
                    offlineCtx.startRendering().then(buffer => {
                        const blob = bufferToWave(buffer, length * audioCtx.sampleRate);
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = 'new-session.mp3';
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                        }, 100);
                    });
                }
                
            } catch (error) {
                console.error('Audio Context not supported or error generating sound', error);
            }
        }

        // Hàm tạo âm thanh thông báo chung
        function createNotificationSound(play = false, download = false) {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioCtx = new AudioContext();
                
                // Tạo oscillator
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sine';
                
                // Tạo gain node để điều chỉnh âm lượng
                const gainNode = audioCtx.createGain();
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
                
                // Kết nối và bắt đầu
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                // Tạo âm thanh với tần số thay đổi
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4
                
                if (play) {
                    oscillator.start();
                    oscillator.frequency.linearRampToValueAtTime(880, audioCtx.currentTime + 0.2); // A5
                    oscillator.stop(audioCtx.currentTime + 0.4);
                    return;
                }
                
                // Xuất ra file audio khi download
                if (download) {
                    const length = 0.4;
                    const offlineCtx = new OfflineAudioContext(1, length * audioCtx.sampleRate, audioCtx.sampleRate);
                    
                    const offlineOscillator = offlineCtx.createOscillator();
                    offlineOscillator.type = 'sine';
                    
                    const offlineGain = offlineCtx.createGain();
                    offlineGain.gain.setValueAtTime(0, offlineCtx.currentTime);
                    offlineGain.gain.linearRampToValueAtTime(0.3, offlineCtx.currentTime + 0.01);
                    offlineGain.gain.linearRampToValueAtTime(0, offlineCtx.currentTime + 0.4);
                    
                    offlineOscillator.connect(offlineGain);
                    offlineGain.connect(offlineCtx.destination);
                    
                    offlineOscillator.frequency.setValueAtTime(440, offlineCtx.currentTime); // A4
                    offlineOscillator.start();
                    offlineOscillator.frequency.linearRampToValueAtTime(880, offlineCtx.currentTime + 0.2); // A5
                    offlineOscillator.stop(offlineCtx.currentTime + 0.4);
                    
                    offlineCtx.startRendering().then(buffer => {
                        const blob = bufferToWave(buffer, length * audioCtx.sampleRate);
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = 'notification.mp3';
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                        }, 100);
                    });
                }
                
            } catch (error) {
                console.error('Audio Context not supported or error generating sound', error);
            }
        }

        // Hàm tạo âm thanh kiểm tra
        function createTestSound(play = false, download = false) {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioCtx = new AudioContext();
                
                // Tạo oscillator
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sine';
                
                // Tạo gain node để điều chỉnh âm lượng
                const gainNode = audioCtx.createGain();
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.01);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.6);
                
                // Kết nối và bắt đầu
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                // Tạo âm thanh 3 nốt
                oscillator.frequency.setValueAtTime(659.25, audioCtx.currentTime); // E5
                
                if (play) {
                    oscillator.start();
                    oscillator.frequency.setValueAtTime(783.99, audioCtx.currentTime + 0.2); // G5
                    oscillator.frequency.setValueAtTime(987.77, audioCtx.currentTime + 0.4); // B5
                    oscillator.stop(audioCtx.currentTime + 0.6);
                    return;
                }
                
                // Xuất ra file audio khi download
                if (download) {
                    const length = 0.6;
                    const offlineCtx = new OfflineAudioContext(1, length * audioCtx.sampleRate, audioCtx.sampleRate);
                    
                    const offlineOscillator = offlineCtx.createOscillator();
                    offlineOscillator.type = 'sine';
                    
                    const offlineGain = offlineCtx.createGain();
                    offlineGain.gain.setValueAtTime(0, offlineCtx.currentTime);
                    offlineGain.gain.linearRampToValueAtTime(0.3, offlineCtx.currentTime + 0.01);
                    offlineGain.gain.linearRampToValueAtTime(0, offlineCtx.currentTime + 0.6);
                    
                    offlineOscillator.connect(offlineGain);
                    offlineGain.connect(offlineCtx.destination);
                    
                    offlineOscillator.frequency.setValueAtTime(659.25, offlineCtx.currentTime); // E5
                    offlineOscillator.start();
                    offlineOscillator.frequency.setValueAtTime(783.99, offlineCtx.currentTime + 0.2); // G5
                    offlineOscillator.frequency.setValueAtTime(987.77, offlineCtx.currentTime + 0.4); // B5
                    offlineOscillator.stop(offlineCtx.currentTime + 0.6);
                    
                    offlineCtx.startRendering().then(buffer => {
                        const blob = bufferToWave(buffer, length * audioCtx.sampleRate);
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = 'test-notification.mp3';
                        document.body.appendChild(a);
                        a.click();
                        setTimeout(() => {
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
                        }, 100);
                    });
                }
                
            } catch (error) {
                console.error('Audio Context not supported or error generating sound', error);
            }
        }

        // Function wrappers for the buttons
        function playMessageSound() {
            createMessageSound(true, false);
        }
        
        function downloadMessageSound() {
            createMessageSound(false, true);
        }
        
        function playNewSessionSound() {
            createNewSessionSound(true, false);
        }
        
        function downloadNewSessionSound() {
            createNewSessionSound(false, true);
        }
        
        function playNotificationSound() {
            createNotificationSound(true, false);
        }
        
        function downloadNotificationSound() {
            createNotificationSound(false, true);
        }
        
        function playTestSound() {
            createTestSound(true, false);
        }
        
        function downloadTestSound() {
            createTestSound(false, true);
        }
    </script>
</body>
</html> 